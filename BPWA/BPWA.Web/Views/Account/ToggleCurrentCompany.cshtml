@inject CurrentUser currentUser
@{
    Layout = null;
}

<style>
    .subtitle {
        text-align: center;
        margin-bottom: 2em;
    }
</style>

<form asp-controller="Account"
      asp-action="ToggleCurrentCompany"
      method="POST"
      class="current_company_form kt-form kt-form--fit">

    <div class="modal-header">
        <h5 class="modal-title">
            @Translations.Companies
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
    </div>

    <div class="modal-body">

        <div class="col-md-12 row">
            <div class="col-md-12 subtitle">
                <h5>@Translations.Do_you_want_to_change_currently_selected_company</h5>
            </div>
            <div class="col-md-12 form-group">
                <select name="CompanyId" id="modal_companyId" class="form-control select2">
                    @if (currentUser.CurrentCompanyId().HasValue)
                    {
                        <option value="@currentUser.CurrentCompanyId()" selected="selected">
                            @currentUser.CurrentCompanyName()
                        </option>
                        <option value="">@Translations.All</option>
                    }
                    else
                    {
                        <option value="" selected="selected">@Translations.All</option>
                    }
                </select>
            </div>
        </div>

    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">@Translations.Close</button>
        <button class="btn btn-primary" type="submit">@Translations.Change</button>
        <button class="btn btn-primary select_all" type="button">@Translations.Select_all</button>
    </div>

</form>

<script>

    Select2AjaxCompanies({
        element: '#modal_companyId',
        placeholder: '@Translations.All'
    });

    var form = $('.current_company_form')[0];
    $(form).attr('action', `${$(form).attr('action')}?returnUrl=${window.location.pathname}`);

    $('.select_all').on('click', function (e) {
        $('#modal_companyId').val('');
        var form = $('.current_company_form')[0];
        form.submit();
    });

</script>